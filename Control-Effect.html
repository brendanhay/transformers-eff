<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Control.Effect</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Control-Effect.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">effect-interpreters-0.1.0.0</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Control.Effect</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Core API</a></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:Eff">Eff</a> effect m a</li><li class="src short"><span class="keyword">data</span> <a href="#t:Interpretation">Interpretation</a> effect f m = <a href="#v:Interpretation">Interpretation</a> {<ul class="subs"><li><a href="#v:run">run</a> :: <span class="keyword">forall</span> a b. (a -&gt; m (f b)) -&gt; effect a -&gt; m (f b)</li><li><a href="#v:finalize">finalize</a> :: <span class="keyword">forall</span> a. a -&gt; f a</li></ul>}</li><li class="src short"><a href="#v:handle">handle</a> :: <a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Effect.html#t:Interpretation">Interpretation</a> effect f m -&gt; <a href="Control-Effect.html#t:Eff">Eff</a> effect m a -&gt; m (f a)</li><li class="src short"><span class="keyword">class</span> <a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="#t:LiftProgram">LiftProgram</a> f m | m -&gt; f <span class="keyword">where</span><ul class="subs"><li><a href="#v:liftProgram">liftProgram</a> :: f a -&gt; m a</li></ul></li></ul></div><div id="interface"><h1>Documentation</h1><div class="doc"><p>Welcome to <code>effect-interpreters</code>, a composable approach to managing effects in
functional programming. <code>effect-interpreters</code> provides you with a toolkit to
write programs that are polymorphic over the choice of monad, stipulating that
whatever monad is chosen has access to certain underlying effects.
<code>effect-interpreters</code> comes with the <code><a href="Control-Effect.html#t:Eff">Eff</a></code> monad to eliminate individual effects
one-by-one, and allows you to easily define your own effects and multiple
interpretations. In this short guide, I'll demonstrate how to get started with
this library.</p><p>Within <code>effect-interpreters</code>, effects consist of:</p><ol><li>A language to write programs using operations within the given effect</li><li>Interpretations of these effects using only the effects of a &quot;smaller&quot; monad.</li></ol><p>To start, let's walk through the construction of an effect for failure. You're
probably already familiar with the language to write failing programs - it's the
<code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a></code> monad! Within the <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a></code> monad, we have the ability to fail earlier
by using <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Data-Maybe.html#v:Nothing">Nothing</a></code>, or we can produce successful values with <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Data-Maybe.html#v:Just">Just</a></code> or <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#v:return">return</a></code>.
Importantly, we can combine multiple <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a></code> programs together by using its
<code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a></code> instance.</p><p>Now that we have our language, we need to write interpretations of <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a></code>. One
such interpretation in any bigger monad is to run the program down to <code>Maybe a</code>.
That is, we seek a combinator with a type similar to:</p><pre>attempt :: PotentiallyFailing a -&gt; m (Maybe a)
</pre><p>Here <code>attempt</code> will attempt to run a program and handle the case when it
attempts to fail. We can build this combinator using <code>effect-interpreters</code> with
<code><a href="Control-Effect.html#v:handle">handle</a></code>:</p><pre>attempt :: Eff Maybe m a -&gt; m (Maybe a)
attempt =
  handle Intepretation { run = continue p -&gt; case p of
                                                Just a -&gt; continue a
                                                Nothing -&gt; return Nothing
                       , finalize = Just}
</pre><p>Let's take this line by line. On the first line with the type. It's similar to
the type I suggested earlier, but to speak specifically about
<code>PotentiallyFailing</code> programs means to be working in an <code><a href="Control-Effect.html#t:Eff">Eff</a></code> monad transformer
that has the ability to interpret to <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a></code> programs.</p><p>Next, we build our <code><a href="Control-Effect.html#t:Interpretation">Interpretation</a></code> and eliminate the <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a></code> effect by calling
<code><a href="Control-Effect.html#v:handle">handle</a></code> with this interpretation. An <code>Intepreration</code> consists of a way to run
effectful computations, and a way to lift pure values into the final return
type.</p><p>To understand <code><a href="Control-Effect.html#v:run">run</a></code>, let's specialize the type of it given what we know. We know
that the <code>Intepreration</code> we are building has type
'Interpretation Maybe Maybe m'. This means that <code><a href="Control-Effect.html#v:run">run</a></code> has the type:</p><pre>run :: forall a b. (a -&gt; m (Maybe b)) -&gt; Maybe a -&gt; m (Maybe b)
</pre><p>The first argument to <code><a href="Control-Effect.html#v:run">run</a></code> is a <em>continuation</em>. Whenever we try and lift a
an effect into <code><a href="Control-Effect.html#t:Eff">Eff</a></code>, we are given the rest of the program - it's then up to the
<code><a href="Control-Effect.html#t:Interpretation">Interpretation</a></code> if it will actually continue. In the case of failing programs,
it depends. If we're lifting a successful program - that is, <code>Just a</code> - then we
can continue, but if we're lifting a failure then we certainly can't continue.
If you now return to our definition of run, you'll see that we pattern match
on the effectful program that we have to run, continuing or failing as
appropriate.</p><p>The other part of an <code><a href="Control-Effect.html#t:Interpretation">Interpretation</a></code> is a description of what happens if we
never use the effect that we have access to. That is, what if we are told to
run an 'Eff Maybe' program that never actually uses the ability to fail? In this
case, we have to provide a way to lift pure values into the same context as
<code><a href="Control-Effect.html#v:run">run</a></code> - so we simply treat it as success.</p></div><h1 id="g:1">Core API</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Eff" class="def">Eff</a> effect m a</p><div class="doc"><p>The <code><a href="Control-Effect.html#t:Eff">Eff</a></code> monad transformer is used to write programs that require access to
 specific effects. In this library, effects are combined by stacking multiple
 <code><a href="Control-Effect.html#t:Eff">Eff</a></code>s together. <code><a href="Control-Effect.html#t:Eff">Eff</a></code>s are parameterized by an effect <em>algebra</em>. This is a
 description of programs in a single effect, such as non-determinism (<code>[]</code>)or
 exceptions (<code>Either e</code>). As <code><a href="Control-Effect.html#t:Eff">Eff</a></code> is a monad transformer, <code>m</code> is the monad
 that <code><a href="Control-Effect.html#t:Eff">Eff</a></code> transforms, which can itself be another instance of <code><a href="Control-Effect.html#t:Eff">Eff</a></code>.</p></div><div class="subs instances"><p id="control.i:Eff" class="caption collapser" onclick="toggleSection('i:Eff')">Instances</p><div id="section.i:Eff" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Effect.html#t:LiftProgram">LiftProgram</a> f (<a href="Control-Effect.html#t:Eff">Eff</a> f m)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Effect-Environment.html#t:EffEnvironment">EffEnvironment</a> env (<a href="Control-Effect.html#t:Eff">Eff</a> ((-&gt;) env) m)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/transformers-0.4.2.0/Control-Monad-Trans-Class.html#t:MonadTrans">MonadTrans</a> (<a href="Control-Effect.html#t:Eff">Eff</a> effect)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> (<a href="Control-Effect.html#t:Eff">Eff</a> effect m)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Data-Functor.html#t:Functor">Functor</a> (<a href="Control-Effect.html#t:Eff">Eff</a> effect m)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Applicative.html#t:Applicative">Applicative</a> (<a href="Control-Effect.html#t:Eff">Eff</a> effect m)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="Control-Effect-IO.html#t:MonadUIO">MonadUIO</a> m =&gt; <a href="Control-Effect-IO.html#t:MonadUIO">MonadUIO</a> (<a href="Control-Effect.html#t:Eff">Eff</a> r m)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Effect-Nondeterminism.html#t:Nondeterministic">Nondeterministic</a> (<a href="Control-Effect.html#t:Eff">Eff</a> [] m)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">(<a href="Control-Effect-Nondeterminism.html#t:Nondeterministic">Nondeterministic</a> m, <a href="Control-Effect.html#t:LiftProgram">LiftProgram</a> [] m) =&gt; <a href="Control-Effect-Nondeterminism.html#t:Nondeterministic">Nondeterministic</a> (<a href="Control-Effect.html#t:Eff">Eff</a> f m)</span></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Interpretation" class="def">Interpretation</a> effect f m</p><div class="doc"><p>Effects can have many different interpretations. We use <code><a href="Control-Effect.html#t:Interpretation">Interpretation</a></code> to
 provide a specific evaluation strategy for an effect. It is parameterized
 over <code>effect</code>, the effect that we are interpreting; and <code>f</code>, the target
 functor that we will evaluate into. Interpretations also have access to the
 underlying monad <code>m</code> (and are free to incur extra constraints on <code>m</code> if
 necessary).</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Interpretation" class="def">Interpretation</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:run" class="def">run</a> :: <span class="keyword">forall</span> a b. (a -&gt; m (f b)) -&gt; effect a -&gt; m (f b)</dt><dd class="doc"><p><code><a href="Control-Effect.html#v:run">run</a></code> defines how to run programs specified by the <code>effect</code> functor. It is provided both the program to run, but also a continuation for the rest of the program. <code><a href="Control-Effect.html#v:run">run</a></code> is free to invoke this continuation zero, one or many times, in order to build the output of evaluation under some functor <code>f</code>.</p></dd><dt class="src"><a name="v:finalize" class="def">finalize</a> :: <span class="keyword">forall</span> a. a -&gt; f a</dt><dd class="doc"><p><code><a href="Control-Effect.html#v:finalize">finalize</a></code> is used to lift the return type of any computation into <code>f</code>. It is usually defined as <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#v:return">return</a></code> or <code><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Applicative.html#v:pure">pure</a></code>, and plays a similar role.</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><a name="v:handle" class="def">handle</a> :: <a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Effect.html#t:Interpretation">Interpretation</a> effect f m -&gt; <a href="Control-Effect.html#t:Eff">Eff</a> effect m a -&gt; m (f a)</p><div class="doc"><p>In order to run <code><a href="Control-Effect.html#t:Eff">Eff</a></code> computations, we need to provide a way to run its
 effects in the underlying monad <code>m</code>. We use <code><a href="Control-Effect.html#v:handle">handle</a></code> to run a specific
 <code><a href="Control-Effect.html#t:Interpretation">Interpretation</a></code> for an effect. Notice that <code><a href="Control-Effect.html#v:handle">handle</a></code> eliminates one layer
 of <code><a href="Control-Effect.html#t:Eff">Eff</a></code>, returning you with the original <code>a</code> now captured under the
 result of the effects described by the <code>effect</code> functor.</p></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a name="t:LiftProgram" class="def">LiftProgram</a> f m | m -&gt; f <span class="keyword">where</span></p><div class="doc"><p><code><a href="Control-Effect.html#t:LiftProgram">LiftProgram</a></code> defines an <code>mtl</code>-style type class for automatically lifting
 effects into <code><a href="Control-Effect.html#t:Eff">Eff</a></code> stacks. When exporting libraries that you intend to
 publish on Hackage, it's suggested that you still provide your own type class
 (such as <code>MonadThrow</code> or <code>MonadHTTP</code>) to avoid locking people into this
 library, but <code><a href="Control-Effect.html#v:liftProgram">liftProgram</a></code> can be useful to define your own instances of
 that type class for <code><a href="Control-Effect.html#t:Eff">Eff</a></code>.</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a name="v:liftProgram" class="def">liftProgram</a> :: f a -&gt; m a</p></div><div class="subs instances"><p id="control.i:LiftProgram" class="caption collapser" onclick="toggleSection('i:LiftProgram')">Instances</p><div id="section.i:LiftProgram" class="show"><table><tr><td class="src clearfix"><span class="inst-left">(<a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m, <a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> (t m), <a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/transformers-0.4.2.0/Control-Monad-Trans-Class.html#t:MonadTrans">MonadTrans</a> t, <a href="Control-Effect.html#t:LiftProgram">LiftProgram</a> f m) =&gt; <a href="Control-Effect.html#t:LiftProgram">LiftProgram</a> f (t m)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="file:///nix/store/xyzzg5cbk1kh1n4s2q9n76lrqnzxxld8-ghc-7.10.3/share/doc/ghc/html/libraries/base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Effect.html#t:LiftProgram">LiftProgram</a> f (<a href="Control-Effect.html#t:Eff">Eff</a> f m)</span></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>